<div
  class='clearfix'
  *ngIf='torrent && torrent.name'
  style='margin-bottom:1em;'>

<div class="row" style='margin-bottom:1em'>
  <p class="col-md-11">
    {{ torrent.name }}
    <i *ngIf='torrent.priv' class="fa fa-lock text-muted"></i>
  </p>
  <p class="col-md-1 text-right" *ngIf='torrent.label'>
    <span class="label label-default" style='display:block'>{{ torrent.label }}</span>
  </p>
</div>

<progress-bar
  [active]='(torrent.state == "Downloading" && torrent.downloadSpeed > 0) ||
    (torrent.state == "Seeding" && torrent.uploadSpeed > 0)'
  [color]='color'
  [percentage]='torrent.progress'
  [reverse]='torrent.state == "Seeding" && torrent.uploadSpeed > 0'></progress-bar>

<ui-tabs listClasses='nav nav-tabs nav-justified'>
  <template ui-pane title='General' active='true'>
    <div style='margin:1em 0'>
      <div class="row">
        <div class="col-md-4 clearfix">
          <div class="pull-left text-muted">Time Active:</div>
          <div class="pull-right">{{ torrent.timeActive | duration:'s' }}</div>
        </div>

        <div class="col-md-4 clearfix">
          <div class="pull-left text-muted">Remaining:</div>
          <div class="pull-right">{{ torrent.timeRemaining | duration:'s' }}</div>
        </div>

        <div class="col-md-4 clearfix">
          <div class="pull-left text-muted">Added:</div>
          <div class="pull-right">{{ torrent.timeAdded * 1000 | date:"EEEE, MMMM d, y hh" }}</div>
        </div>

        <div class="col-md-4 clearfix">
          <div class="pull-left text-muted">Downloaded:</div>
          <div class="pull-right">{{ torrent.totalDownloaded | bytes:2 }}</div>
        </div>

        <div class="col-md-4 clearfix">
          <div class="pull-left text-muted">Uploaded:</div>
          <div class="pull-right">{{ torrent.totalUploaded | bytes:2 }}</div>
        </div>

        <div class="col-md-4 clearfix">
          <div class="pull-left text-muted">Ratio:</div>
          <div class="pull-right">{{ torrent.ratio | number:'1.0-2' }}</div>
        </div>

        <div class="col-md-4 clearfix">
          <div class="pull-left text-muted">Download Speed:</div>
          <div class="pull-right">{{ torrent.downloadSpeed | bytes:2 }}/s</div>
        </div>

        <div class="col-md-4 clearfix">
          <div class="pull-left text-muted">Upload Speed:</div>
          <div class="pull-right">{{ torrent.uploadSpeed | bytes:2 }}/s</div>
        </div>

        <div class="col-md-4 clearfix">
          <div class="pull-left text-muted">Peers:</div>
          <div class="pull-right">{{ torrent.peersCount }}</div>
        </div>

        <div class="col-md-4 clearfix">
          <div class="pull-left text-muted">Size:</div>
          <div class="pull-right">{{ torrent.size | bytes:2 }}</div>
        </div>
      </div>

      <div class='clearfix' *ngIf='torrent.comment'>
        <hr />
        <div class="pull-left text-muted">Comment:</div>
        <div class='pull-right'>{{ torrent.comment }}</div>
      </div>
    </div>
  </template>

  <template ui-pane title='Connections'>
    <!-- TODO: Tracker Status -->
    <!-- TODO: Verified -->
    <!-- TODO: Updating -->
    <!-- TODO: Send Stats -->
    <div *ngIf='torrent.trackers.values.length > 0'>
      <h3>Trackers <small>({{ torrent.trackers.values.length }})</small></h3>
      <table class='table table-striped'>
        <thead>
          <tr>
            <th class='fit-content'>Tier</th>
            <th>Location</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor='let t of torrent.trackers.values'>
            <td>{{ t.tier }}</td>
            <td>{{ t.url }}</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div *ngIf='torrent.peers.values.length > 0'>
      <h3>Peers <small>({{ torrent.peers.values.length }})</small></h3>
      <table class='table table-striped'>
        <thead>
          <tr>
            <th>Country</th>
            <th>IP</th>
            <th>Download Speed</th>
            <th>Upload Speed</th>
            <th>Client</th>
            <th>Progress</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor='let p of torrent.peers.values'>
            <td>{{ p.country }}</td>
            <td>{{ p.ip }}</td>
            <td>{{ p.downloadSpeed | bytes:2 }}/s</td>
            <td>{{ p.uploadSpeed | bytes:2 }}/s</td>
            <td>{{ p.client }}</td>
            <td>{{ p.progress * 100 | number:'1.0-2' }}%</td>
          </tr>
        </tbody>
      </table>
    </div>
  </template>

  <template ui-pane title='Files'>
    <!-- TODO: Collapse -->
    <!-- TODO: Download Path -->
    <!-- TODO: Adjustable Priority -->
    <h3>Files <small>({{ torrent.files.length }})</small></h3>
    <table class='table table-striped'>
      <thead>
        <tr>
          <th>Path</th>
          <th>Size</th>
          <th>Progress</th>
          <th>Priority</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor='let f of torrent.files'>
          <td>{{ f.path }}</td>
          <td>{{ f.len | bytes:2 }}</td>
          <td>{{ f.progress * 100 | number:'1.0-2' }}%</td>
          <td>{{ f.priority }}</td>
        </tr>
      </tbody>
    </table>
  </template>

  <template ui-pane title='Options'>
    <h3>Options</h3>

    <speedinput-view
      [(model)]='torrent.configuration.maximumDownloadSpeed'
      title='Maximum Download Speed'></speedinput-view>

    <speedinput-view
      [(model)]='torrent.configuration.maximumUploadSpeed'
      title='Maximum Upload Speed'></speedinput-view>

    <numberinput-view
      [(model)]='torrent.configuration.maximumConnections'
      title='Maximum Connections'></numberinput-view>

    <numberinput-view
      [(model)]='torrent.configuration.maximumUploadSlots'
      title='Maximum Upload Slots'></numberinput-view>

    <numberinput-view
      [(model)]='torrent.configuration.stopRatio'
      [(checkbox)]='torrent.configuration.stopAtRatio'
      addon='true'
      title='Stop at Ratio'></numberinput-view>

    <checkbox-view
      [(model)]='torrent.configuration.removeAtRatio'
      [disabled]='!torrent.configuration.stopAtRatio'
      title='Remove at Ratio'></checkbox-view>

    <textinput-view
      [(model)]='torrent.configuration.completedPath'
      [(checkbox)]='torrent.configuration.moveCompleted'
      addon='true'
      title='Move on Completion'></textinput-view>

    <checkbox-view
      [(model)]='torrent.configuration.prioritized'
      title='Prioritize First and Last Pieces'></checkbox-view>

    <checkbox-view
      [(model)]='torrent.configuration.managed'
      title='Managed'></checkbox-view>

    <button
      class='btn btn-default pull-right'
      (click)='ds.updateTorrentSettings()'>Submit</button>
  </template>
</ui-tabs>
</div>

